<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyBin: Smart Trash Separator</title>

    <!-- Security Headers -->
    <!-- Note: CSP should be set via HTTP headers for production -->

    <!-- PWA Configuration -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#10b981">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="EasyBin">

    <!-- External Resources with Integrity -->
    <!-- Tailwind CSS v4 Browser Build (Production) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" onerror="console.warn('Font Awesome failed to load')">

    <!-- Puter JS - Load with better error handling -->
    <script>
        // Dynamic Puter.js loading with fallback
        (function () {
            // Set default state
            window.puterLoaded = false;

            const script = document.createElement('script');
            script.src = 'https://js.puter.com/v2/';
            script.crossOrigin = 'anonymous';
            script.async = true;
            script.onload = function () {
                console.log('‚úÖ Puter.js loaded successfully');
                window.puterLoaded = true;
            };
            script.onerror = function () {
                console.log('üîß Puter.js not available - using fallback API');
                window.puterLoaded = false;
            };
            document.head.appendChild(script);
        })();
    </script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="src/css/styles.css">
    <link rel="stylesheet" href="magicui-extracted.css">

    <!-- Security Module -->
    <script src="src/js/security.js"></script>
</head>

<body class="bg-gradient-to-br from-gray-50 via-white to-blue-50 font-sans md:overflow-hidden overflow-x-hidden">
    <!-- Bento Grid Container -->
    <div class="bento-grid">
        <!-- Controls Card -->
        <div
            class="controls-card bento-card neon-gradient-card bg-white/10 backdrop-blur-lg text-gray-900 dark:text-white shadow-xl ring-1 ring-white/20 border border-white/30">
            <div class="meteors-container"></div>
            <div class="animated-grid-pattern"></div>
            <div class="relative z-10 p-6 h-full flex flex-col">
                <div class="blur-fade blur-fade-1 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <i class="fas fa-cog text-2xl mr-3 text-gray-700 dark:text-white/90"></i>
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white">Controls</h3>
                        </div>
                        <div class="flex items-center gap-2">
                            <!-- API Keys Button -->
                            <button id="api-keys-button"
                                class="animated-theme-toggler bg-white/20 dark:bg-black/40 border-2 border-white/30 dark:border-white/20"
                                aria-label="Configure API Keys" title="Configure API Keys">
                                üîë
                            </button>
                            <!-- Animated Theme Toggle -->
                            <button id="animated-theme-toggle"
                                class="animated-theme-toggler bg-white/20 dark:bg-black/40 border-2 border-white/30 dark:border-white/20"
                                aria-label="Toggle theme" title="Toggle dark/light mode">
                                <i id="theme-toggle-icon"
                                    class="fas fa-sun theme-icon text-yellow-500 dark:text-blue-300"
                                    aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Language Selector -->
                <div class="blur-fade blur-fade-2 mb-4">
                    <label id="language-label" for="language-select"
                        class="block text-gray-700 dark:text-white/90 mb-2 font-medium">Language</label>
                    <select id="language-select"
                        class="w-full p-3 rounded-lg glass-card bg-white/20 text-gray-900 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 focus:outline-none transition-all duration-300"
                        aria-label="Select language">
                        <option value="en">English</option>
                        <option value="de">Deutsch</option>
                        <option value="it">Italiano</option>
                        <option value="pt">Portugu√™s</option>
                    </select>
                </div>

                <!-- Region Selector -->
                <div class="blur-fade blur-fade-3 mb-4">
                    <label id="country-label" for="country-select"
                        class="block text-gray-700 dark:text-white/90 mb-2 font-medium">Region</label>
                    <select id="country-select"
                        class="w-full p-3 rounded-lg glass-card bg-white/20 text-gray-900 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 focus:outline-none transition-all duration-300"
                        aria-label="Select region">
                        <option value="us">United States</option>
                        <option value="de">Germany</option>
                        <option value="it">Italy</option>
                        <option value="br">Brazil</option>
                    </select>
                </div>

                <!-- Network Status Indicator -->
                <div id="network-status"
                    class="blur-fade blur-fade-4 mb-4 text-sm text-gray-700 dark:text-gray-300 hidden">
                    <div class="glass-card p-2 inline-flex items-center">
                        <i class="fas fa-wifi text-blue-500 mr-2"></i>
                        <span>Online</span>
                    </div>
                </div>


                <!-- Instructions -->
                <div class="blur-fade blur-fade-4 flex-grow">
                    <div class="glass-card bg-white/10 p-4 mb-4 rounded-lg ring-1 ring-white/20">
                        <div id="instructions-text" class="text-sm text-gray-700 dark:text-white/90 font-medium">
                            <strong>How to use:</strong> Point your camera at an item and tap "Identify Item" to get
                            sorting instructions.
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Camera Card -->
        <div id="camera-container"
            class="camera-card bento-card neon-gradient-card bg-gradient-to-br from-slate-800 to-slate-900 relative overflow-hidden cool-mode-container shadow-2xl ring-1 ring-white/10">
            <div class="border-beam"></div>
            <div class="warp-background"></div>
            <div class="beam-container"></div>
            <video id="camera" playsinline muted
                class="absolute inset-0 w-full h-full object-cover transition-transform duration-300 hover:scale-105 hidden"
                aria-label="Camera view for item identification"></video>
            <div id="camera-overlay"
                class="absolute inset-0 border-4 border-dashed border-green-400 pointer-events-none opacity-70 animate-pulse hidden"
                aria-hidden="true"></div>

            <!-- Identify Item Button (overlaid on camera) -->
            <div id="identify-button-container"
                class="absolute bottom-6 left-1/2 transform -translate-x-1/2 z-20 hidden">
                <button id="scan-button"
                    class="shimmer-button px-8 py-4 text-xl font-bold shadow-2xl hover:scale-105 transition-all duration-300 focus:ring-2 focus:ring-white/50 focus:outline-none bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-full animate-fade-in"
                    aria-label="Take photo to identify item">
                    <i class="fas fa-camera mr-3" aria-hidden="true"></i>
                    <span id="scan-button-text">Identify Item</span>
                </button>
            </div>

            <!-- Open Camera Button -->
            <div id="open-camera-container" class="absolute inset-0 flex items-center justify-center">
                <button id="open-camera-button"
                    class="shimmer-button px-8 py-4 text-xl font-bold shadow-lg hover:scale-105 transition-all duration-300 focus:ring-2 focus:ring-white/50 focus:outline-none">
                    <i class="fas fa-video mr-3" aria-hidden="true"></i>
                    Open Camera
                </button>
            </div>

            <!-- Enhanced Camera Loading State -->
            <div id="camera-loading"
                class="absolute inset-0 bg-gradient-to-br from-slate-800 to-slate-900 flex items-center justify-center hidden">
                <div class="text-center text-white glass-card p-6 rounded-2xl">
                    <!-- Orbiting Circles Animation -->
                    <div class="orbiting-circles mb-4"></div>
                    <p class="font-medium text-lg mb-2 hyper-text">Initializing camera...</p>
                    <p class="text-sm opacity-75">Please allow camera access</p>
                </div>
            </div>

            <!-- Camera Permission Denied Help -->
            <div id="camera-permission-denied"
                class="absolute inset-0 bg-gradient-to-br from-slate-800 to-slate-900 flex items-center justify-center hidden">
                <div class="text-center text-white max-w-sm mx-4 glass-card p-6 rounded-2xl">
                    <div class="text-6xl mb-4">üì±</div>
                    <h3 class="text-xl font-bold mb-2">Camera Access Required</h3>
                    <p class="text-gray-300 mb-4">EasyBin needs camera access to identify items for proper waste
                        sorting.</p>
                    <div class="glass-card rounded-lg p-4 mb-4 text-left">
                        <h4 class="font-semibold mb-2">To enable camera:</h4>
                        <ol class="text-sm text-gray-600 space-y-1">
                            <li>1. Tap the camera icon in your browser's address bar</li>
                            <li>2. Select "Allow" or "Always allow"</li>
                            <li>3. Refresh this page</li>
                        </ol>
                    </div>
                    <button id="retry-camera" class="shimmer-button px-6 py-3">
                        <i class="fas fa-redo mr-2" aria-hidden="true"></i>
                        Try Again
                    </button>
                </div>
            </div>

            <!-- Enhanced Scanning Animation with Circular Progress -->
            <div id="scanning-overlay"
                class="absolute inset-0 bg-black bg-opacity-30 hidden items-center justify-center backdrop-blur-sm">
                <div class="text-white text-center glass-card p-6 rounded-2xl">
                    <!-- Circular Progress Bar -->
                    <div id="scan-progress" class="circular-progress mb-4 mx-auto"
                        style="--bg-color: rgba(30, 41, 59, 0.8);">
                        <div class="circular-progress-content">
                            <div class="circular-progress-percentage">0%</div>
                            <div class="circular-progress-label">Starting...</div>
                        </div>
                    </div>
                    <p class="font-medium text-lg hyper-text" id="scan-status">Analyzing item...</p>
                    <p class="text-sm opacity-90 mt-2">Using AI to identify waste type</p>
                </div>
            </div>
        </div>

        <!-- Results Card -->
        <div
            class="results-card bento-card glass-card bg-white/80 dark:bg-black/40 backdrop-blur-xl overflow-auto shadow-xl ring-1 ring-white/20">
            <div class="magic-card h-full">
                <div class="particles-container"></div>

                <!-- Welcome State (Default View) -->
                <div id="welcome-state" class="text-center py-12 px-6 relative z-10">
                    <div class="blur-fade blur-fade-1 relative mb-6">
                        <i class="fas fa-leaf text-6xl text-green-500 mb-4 block" aria-hidden="true"></i>
                        <div
                            class="absolute top-0 left-1/2 transform -translate-x-1/2 w-20 h-20 bg-green-100 rounded-full opacity-50 animate-pulse">
                        </div>
                    </div>

                    <div class="blur-fade blur-fade-2">
                        <h2 id="app-title-text"
                            class="text-4xl font-bold aurora-text mb-3 bg-gradient-to-r from-emerald-600 via-blue-600 to-purple-600 bg-clip-text text-transparent">
                            EasyBin
                        </h2>
                        <p class="text-gray-700 dark:text-gray-300 mb-4 text-lg font-medium">Smart waste sorting made
                            simple</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-8">Point your camera at any item to get
                            instant sorting instructions</p>
                    </div>

                    <!-- Environmental Impact Stats with Number Tickers -->
                    <div class="blur-fade blur-fade-3 flex justify-center space-x-4 mb-8">
                        <div
                            class="bg-white/30 dark:bg-black/40 border border-white/40 dark:border-white/30 backdrop-blur-md rounded-lg p-3 transition-all duration-200 hover:-translate-y-1">
                            <div class="text-2xl font-bold text-green-600 number-ticker" id="items-sorted">0</div>
                            <div class="text-xs text-gray-600 dark:text-gray-300 mt-1">Items Sorted</div>
                        </div>
                        <div
                            class="bg-white/30 dark:bg-black/40 border border-white/40 dark:border-white/30 backdrop-blur-md rounded-lg p-3 transition-all duration-200 hover:-translate-y-1">
                            <div class="text-2xl font-bold text-blue-600 number-ticker" id="co2-saved">0.0</div>
                            <div class="text-xs text-gray-600 dark:text-gray-300 mt-1">kg CO‚ÇÇ Saved</div>
                        </div>
                        <div
                            class="bg-white/30 dark:bg-black/40 border border-white/40 dark:border-white/30 backdrop-blur-md rounded-lg p-3 transition-all duration-200 hover:-translate-y-1">
                            <div class="text-2xl font-bold text-purple-600 number-ticker" id="accuracy-rate">95</div>
                            <div class="text-xs text-gray-600 dark:text-gray-300 mt-1">% Accuracy</div>
                        </div>
                    </div>

                    <!-- Recent History Section -->
                    <div class="blur-fade blur-fade-4 mt-8 px-4">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center justify-center">
                            <i class="fas fa-history mr-2 text-blue-500" aria-hidden="true"></i>
                            Recent Scans
                        </h3>
                        <div id="recent-history-list" class="animated-list space-y-2">
                            <div
                                class="text-center text-sm py-4 glass-card bg-white/35 dark:bg-black/40 border border-white/40 dark:border-white/30 text-gray-800 dark:text-gray-200">
                                <i class="fas fa-camera text-gray-600 dark:text-gray-400 text-2xl mb-2 block"
                                    aria-hidden="true"></i>
                                No scans yet. Start by identifying an item!
                            </div>
                        </div>
                        <div class="text-center mt-4">
                            <button id="view-all-history"
                                class="text-sm font-bold transition-colors glass-card bg-white/35 dark:bg-black/40 border border-white/40 dark:border-white/30 text-blue-800 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 px-4 py-2 rounded-lg">
                                <i class="fas fa-list mr-1" aria-hidden="true"></i>
                                View All History
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Scan Results (Hidden by Default) -->
                <div id="result-content" class="p-6 hidden" role="region" aria-label="Identification results">
                    <div id="bin-header"
                        class="text-center text-2xl font-bold mb-4 rounded-2xl transition-all duration-500 morphing-text">
                    </div>
                    <div class="item-details">
                        <div id="item-name" class="text-xl mb-2 font-semibold hyper-text"></div>
                        <div id="bin-instructions"
                            class="glass-card p-4 rounded-lg mb-3 border-l-4 border-green-500 sparkles-text"></div>
                        <hr id="details-hr" class="my-4 border-gray-200" style="display: none;">
                        <div id="item-description" class="text-gray-600 leading-relaxed"></div>
                        <!-- Image Preview with Lens Component -->
                        <div id="captured-image-container" class="mt-4 text-center hidden">
                            <div class="lens-container inline-block">
                                <img id="captured-image" src="" alt="Captured item"
                                    class="max-w-full max-h-48 rounded-lg shadow-lg">
                                <div class="lens-zoom"></div>
                            </div>
                            <p class="text-sm text-gray-500 mt-2">Click image to zoom</p>
                            <button id="settings-button" class="settings-button" aria-label="Settings">
                                <svg class="settings-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="3"></circle>
                                    <path
                                        d="M12 1v6m0 6v6m5.66-13.66l-4.24 4.24m-2.82 2.82l-4.24 4.24m13.66 1.42l-4.24-4.24m-2.82-2.82l-4.24-4.24">
                                    </path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div id="country-note" style="display: none;"></div>

                    <!-- Action Buttons -->
                    <div class="mt-6 space-y-4">
                        <button id="retake-button"
                            class="w-full bg-white/40 dark:bg-black/40 border border-white/30 dark:border-white/30 text-gray-800 dark:text-gray-200 p-3 flex items-center justify-center rounded-lg backdrop-blur-sm hover:bg-white/50 dark:hover:bg-black/50 transition-all duration-200"
                            aria-label="Take another photo">
                            <i class="fas fa-camera mr-2" aria-hidden="true"></i>
                            <span id="retake-button-text">Take Another Photo</span>
                        </button>

                        <button id="share-button"
                            class="w-full bg-blue-500 hover:bg-blue-600 text-white p-3 flex items-center justify-center rounded-lg backdrop-blur-sm transition-all duration-200"
                            aria-label="Share results">
                            <i class="fas fa-share-alt mr-2" aria-hidden="true"></i>
                            <span id="share-button-text">Share Results</span>
                        </button>

                        <button id="save-button"
                            class="w-full bg-green-500 hover:bg-green-600 text-white p-3 flex items-center justify-center rounded-lg backdrop-blur-sm transition-all duration-200"
                            aria-label="Save results to photos">
                            <i class="fas fa-download mr-2" aria-hidden="true"></i>
                            <span id="save-button-text">Save to Photos</span>
                        </button>
                    </div>
                </div>

                <!-- Status and Loading State -->
                <div id="output" class="absolute bottom-4 left-1/2 transform -translate-x-1/2" aria-live="polite">
                    <div id="app-status"
                        class="text-center text-sm text-gray-800 font-medium py-2 glass-card px-4 rounded-full">
                        <i class="fas fa-leaf text-green-600 mr-1" aria-hidden="true"></i>
                        Ready to scan
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions Card -->
        <div
            class="quick-actions-card bento-card bg-gradient-to-br from-gray-50/90 to-gray-100/90 dark:from-gray-800/90 dark:to-gray-900/90 shadow-lg ring-1 ring-gray-200/50 dark:ring-gray-700/50">
            <div class="p-6 h-full flex flex-col justify-center space-y-3">
                <div class="blur-fade blur-fade-1">
                    <h3 class="text-lg font-bold text-gray-800 dark:text-gray-200 mb-4 flex items-center">
                        <i class="fas fa-bolt mr-2 text-yellow-500"></i>
                        Quick Actions
                    </h3>
                </div>

                <button id="history-button"
                    class="bg-blue-500 hover:bg-blue-600 hover:scale-105 text-white p-3 flex items-center justify-center rounded-lg backdrop-blur-sm transition-all duration-300 blur-fade blur-fade-2 shadow-md focus:ring-2 focus:ring-blue-500/50 focus:outline-none">
                    <i class="fas fa-history mr-2" aria-hidden="true"></i>
                    <span id="history-button-text">Scan History</span>
                </button>

                <button id="tips-button"
                    class="bg-purple-500 hover:bg-purple-600 hover:scale-105 text-white p-3 flex items-center justify-center rounded-lg backdrop-blur-sm transition-all duration-300 blur-fade blur-fade-3 shadow-md focus:ring-2 focus:ring-purple-500/50 focus:outline-none">
                    <i class="fas fa-lightbulb mr-2" aria-hidden="true"></i>
                    <span id="tips-button-text">Quick Tips</span>
                </button>

                <button id="pwa-install-button"
                    class="bg-green-500 hover:bg-green-600 text-white p-3 flex items-center justify-center rounded-lg backdrop-blur-sm transition-all duration-200 hidden blur-fade blur-fade-4"
                    aria-label="Install app">
                    <i class="fas fa-download mr-2" aria-hidden="true"></i>
                    <span>Install App</span>
                </button>

                <button id="enable-notifications-button"
                    class="bg-orange-500 hover:bg-orange-600 text-white p-3 flex items-center justify-center rounded-lg backdrop-blur-sm transition-all duration-200 blur-fade blur-fade-4"
                    aria-label="Enable notifications">
                    <i class="fas fa-bell mr-2" aria-hidden="true"></i>
                    <span id="enable-notifications-button-text">Enable Notifications</span>
                </button>
            </div>
        </div>

        <!-- Primary Action Card -->
        <div
            class="primary-action-card bento-card neon-gradient-card bg-white/10 backdrop-blur-lg text-gray-900 dark:text-white cool-mode-container shadow-2xl ring-1 ring-white/20">
            <div class="particles-container"></div>
            <div class="flickering-grid"></div>
            <div class="relative z-10 flex items-center justify-center h-full p-6">
                <button id="scan-button-old"
                    class="rainbow-button w-full h-16 text-xl font-bold shadow-2xl hover:scale-105 transition-all duration-300 focus:ring-2 focus:ring-white/50 focus:outline-none"
                    aria-label="Take photo to identify item" disabled>
                    <i class="fas fa-camera mr-3" aria-hidden="true"></i>
                    <span id="scan-button-text-old">Identify Item</span>
                </button>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div id="history-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="magic-card glass-card rounded-2xl max-w-2xl w-full mx-4 max-h-[80vh] flex flex-col">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 id="history-modal-title" class="text-lg font-semibold text-gray-900">Scan History</h3>
                    <button
                        onclick="document.getElementById('history-modal').classList.add('hidden'); document.getElementById('history-modal').classList.remove('flex')"
                        class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100">
                        <i class="fas fa-times" aria-hidden="true"></i>
                    </button>
                </div>
            </div>
            <div id="history-modal-body" class="flex-1 overflow-y-auto p-6">
                <div id="history-empty-state" class="text-center py-12">
                    <div class="relative inline-block mb-6">
                        <i class="fas fa-history text-6xl text-gray-300 mb-4" aria-hidden="true"></i>
                        <div
                            class="absolute top-0 left-1/2 transform -translate-x-1/2 w-20 h-20 bg-gray-100 rounded-full opacity-50">
                        </div>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">No scans yet</h3>
                    <p class="text-gray-500 mb-4">Start scanning items to build your waste sorting history</p>
                    <div class="flex justify-center space-x-4 text-sm">
                        <div class="flex items-center text-gray-700 font-medium glass-card px-3 py-2 rounded-lg">
                            <i class="fas fa-camera mr-1" aria-hidden="true"></i>
                            <span>Take a photo</span>
                        </div>
                        <div class="flex items-center text-gray-700 font-medium glass-card px-3 py-2 rounded-lg">
                            <i class="fas fa-recycle mr-1" aria-hidden="true"></i>
                            <span>Get instructions</span>
                        </div>
                        <div class="flex items-center text-gray-700 font-medium glass-card px-3 py-2 rounded-lg">
                            <i class="fas fa-history mr-1" aria-hidden="true"></i>
                            <span>Track progress</span>
                        </div>
                    </div>
                </div>
                <div id="history-list" class="hidden">
                    <!-- History items will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Tips Overlay -->
    <div id="quick-tips-overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="magic-card glass-card rounded-2xl max-w-md w-full mx-4 p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-900">Quick Tips</h3>
                <button id="close-tips" class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div id="tips-content" class="space-y-4">
                <div class="tip-item glass-card p-4 rounded-lg">
                    <h4 class="font-medium text-gray-900 mb-2">üì∏ Better Photos</h4>
                    <p class="text-gray-600 text-sm">Ensure good lighting and focus on a single item for best results.
                    </p>
                </div>
                <div class="tip-item glass-card p-4 rounded-lg">
                    <h4 class="font-medium text-gray-900 mb-2">‚ôªÔ∏è Recycling Rules</h4>
                    <p class="text-gray-600 text-sm">Clean containers have higher recycling rates. Rinse food residue
                        when possible.</p>
                </div>
                <div class="tip-item glass-card p-4 rounded-lg">
                    <h4 class="font-medium text-gray-900 mb-2">üåç Regional Differences</h4>
                    <p class="text-gray-600 text-sm">Recycling rules vary by location. Check your local guidelines for
                        specifics.</p>
                </div>
                <!-- Scratch to Reveal Environmental Tip -->
                <div class="scratch-to-reveal h-32">
                    <div class="scratch-surface">
                        <div class="flex items-center justify-center h-full text-white">
                            <i class="fas fa-hand-pointer text-2xl mr-2"></i>
                            <span class="font-medium">Scratch to reveal eco-tip!</span>
                        </div>
                    </div>
                    <div class="scratch-content">
                        <h4 class="font-bold text-white mb-2">üåø Eco Bonus Tip!</h4>
                        <p class="text-white text-sm">Every correctly sorted item saves approximately 0.2kg CO‚ÇÇ! You're
                            making a real environmental impact.</p>
                    </div>
                </div>
            </div>
            <div class="mt-6 text-center">
                <button id="next-tip" class="shimmer-button px-6 py-2">
                    Next Tip
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer
        class="fixed bottom-0 left-0 right-0 bg-gray-800/90 backdrop-blur-sm text-white text-center py-2 text-xs z-40">
        <div class="container mx-auto px-4">
            <div class="flex flex-col sm:flex-row justify-between items-center space-y-1 sm:space-y-0">
                <div class="flex items-center space-x-2">
                    <span>&copy; 2025 EasyBin</span>
                    <span class="text-gray-400">|</span>
                    <span id="footer-tagline">Smart waste sorting made simple</span>
                </div>
                <div class="flex items-center space-x-2">
                    <button id="privacy-link" class="text-gray-300 hover:text-white transition-colors px-2">
                        <i class="fas fa-shield-alt mr-1" aria-hidden="true"></i>
                        <span>Privacy</span>
                    </button>
                    <span class="text-gray-400">|</span>
                    <div id="app-version" class="text-gray-400">
                        <i class="fas fa-code-branch mr-1" aria-hidden="true"></i>
                        <span>v2.0.0</span>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript files -->
    <script src="src/js/error-monitor.js"></script>
    <script src="src/js/analytics.js"></script>
    <script src="src/js/translations.js"></script>
    <script src="src/js/binStyles.js"></script>
    <script src="src/js/image-compression.js"></script>

    <!-- Multi-Provider Vision API -->
    <script src="src/js/ai-provider-adapters.js"></script>
    <script src="src/js/ai-vision-client.js"></script>
    <script src="src/js/api-key-manager.js"></script>

    <script src="src/js/app.js"></script>
    <script src="src/js/modern-features.js"></script>
    <script src="src/js/bento-integration.js"></script>

    <!-- PWA Service Worker Registration -->
    <script>
        let deferredPrompt;
        let isAppInstalled = false;

        // Check if app is already installed
        if (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) {
            isAppInstalled = true;
            console.log('App is running in standalone mode');
        }

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Skip service worker in development to avoid errors
                if (window.location.hostname === '127.0.0.1' || window.location.hostname === 'localhost') {
                    console.log('üîß Development mode: Skipping Service Worker registration');
                    return;
                }

                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registered successfully', registration);

                        // Listen for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // Show update available notification
                                    showUpdateAvailable();
                                }
                            });
                        });
                    })
                    .catch(registrationError => {
                        console.log('üîß Service Worker registration skipped:', registrationError.message);
                    });
            });
        }

        // Enhanced install prompt handling
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('beforeinstallprompt fired');
            e.preventDefault();
            deferredPrompt = e;

            // Show install button if not already installed
            if (!isAppInstalled) {
                const installBtn = document.getElementById('pwa-install-button');
                if (installBtn) {
                    installBtn.classList.remove('hidden');
                    installBtn.addEventListener('click', installApp);
                }

                // Show bottom banner after delay (optional)
                setTimeout(showInstallBanner, 10000);
            }
        });

        // Handle app installed event
        window.addEventListener('appinstalled', (evt) => {
            console.log('App was installed');
            isAppInstalled = true;
            hidePWAPrompts();

            // Track installation
            if (window.easyBinAnalytics) {
                window.easyBinAnalytics.trackEvent('pwa_installed', 'engagement');
            }
        });

        // Install app function
        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    } else {
                        console.log('User dismissed the install prompt');
                    }
                    deferredPrompt = null;
                    hidePWAPrompts();
                });
            }
        }

        // Show install banner
        function showInstallBanner() {
            if (isAppInstalled || !deferredPrompt) return;

            const existingBanner = document.getElementById('install-banner');
            if (existingBanner) return; // Don't show multiple banners

            const installBanner = document.createElement('div');
            installBanner.id = 'install-banner';
            installBanner.className = 'fixed bottom-16 left-4 right-4 glass-card text-white p-4 rounded-lg shadow-lg z-50 bg-green-600/90 backdrop-blur-sm animate-bounce';
            installBanner.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <div class="flex items-center">
                            <i class="fas fa-mobile-alt mr-2"></i>
                            <strong>Install EasyBin</strong>
                        </div>
                        <p class="text-sm opacity-90 mt-1">Get quick access and offline functionality</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button id="banner-install-btn" class="bg-white text-green-600 px-4 py-2 rounded font-medium hover:bg-gray-100 transition-colors">
                            Install
                        </button>
                        <button id="banner-dismiss" class="text-white hover:text-gray-200 transition-colors p-2" aria-label="Dismiss">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(installBanner);

            // Add event listeners
            document.getElementById('banner-install-btn').addEventListener('click', () => {
                installApp();
                installBanner.remove();
            });

            document.getElementById('banner-dismiss').addEventListener('click', () => {
                installBanner.remove();
                // Don't show banner again for this session
                sessionStorage.setItem('installBannerDismissed', 'true');
            });

            // Auto-hide after 15 seconds
            setTimeout(() => {
                if (installBanner.parentNode) {
                    installBanner.remove();
                }
            }, 15000);
        }

        // Hide PWA prompts
        function hidePWAPrompts() {
            const installBtn = document.getElementById('pwa-install-button');
            const banner = document.getElementById('install-banner');

            if (installBtn) installBtn.classList.add('hidden');
            if (banner) banner.remove();
        }

        // Show update available notification
        function showUpdateAvailable() {
            const updateNotification = document.createElement('div');
            updateNotification.className = 'fixed top-4 right-4 glass-card bg-blue-600/90 text-white p-4 rounded-lg shadow-lg z-50';
            updateNotification.innerHTML = `
                <div class="flex items-center justify-between">
                    <div>
                        <strong>Update Available</strong>
                        <p class="text-sm">Reload to get the latest features</p>
                    </div>
                    <button id="reload-btn" class="bg-white text-blue-600 px-3 py-1 rounded font-medium ml-4">
                        Reload
                    </button>
                </div>
            `;
            document.body.appendChild(updateNotification);

            document.getElementById('reload-btn').addEventListener('click', () => {
                window.location.reload();
            });
        }

        // Check for updates periodically
        if ('serviceWorker' in navigator) {
            setInterval(() => {
                navigator.serviceWorker.getRegistration().then(registration => {
                    if (registration) {
                        registration.update();
                    }
                });
            }, 60000); // Check every minute
        }
    </script>
    <!-- API Keys Modal -->
    <div id="api-keys-modal"
        class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div
            class="glass-card bg-white/95 dark:bg-gray-900/95 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <!-- Modal Header -->
            <div
                class="sticky top-0 bg-white/95 dark:bg-gray-900/95 border-b border-gray-200 dark:border-gray-700 p-6 rounded-t-2xl">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
                            üîë API Keys Configuration
                        </h2>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                            Configure your API keys for premium vision providers
                        </p>
                    </div>
                    <button id="close-api-keys-modal"
                        class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-2xl">
                        √ó
                    </button>
                </div>
            </div>

            <!-- Modal Body -->
            <div class="p-6 space-y-6">
                <!-- Pollinations API Key -->
                <div class="space-y-2">
                    <label for="pollinations-key" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                        Pollinations API Key (Optional)
                        <span class="text-xs text-gray-500 dark:text-gray-400 ml-2">pk_...</span>
                    </label>
                    <input type="password" id="pollinations-key"
                        class="w-full p-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all"
                        placeholder="pk_9sbL41ofRXSoaOC2">
                    <p class="text-xs text-gray-500 dark:text-gray-400">
                        Get yours at <a href="https://enter.pollinations.ai" target="_blank"
                            class="text-emerald-600 dark:text-emerald-400 hover:underline">enter.pollinations.ai</a>.
                        Free tier works without a key (rate-limited). Publishable keys (pk_) are safe for client-side
                        use.
                    </p>
                </div>

                <!-- OpenRouter API Key -->
                <div class="space-y-2">
                    <label for="openrouter-key" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                        OpenRouter API Key (Optional)
                        <span class="text-xs text-gray-500 dark:text-gray-400 ml-2">sk-or-v1-...</span>
                    </label>
                    <input type="password" id="openrouter-key"
                        class="w-full p-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                        placeholder="sk-or-v1-...">
                    <p class="text-xs text-gray-500 dark:text-gray-400">
                        Get yours at <a href="https://openrouter.ai/keys" target="_blank"
                            class="text-blue-600 dark:text-blue-400 hover:underline">openrouter.ai/keys</a>.
                        Free tier: 50 requests/day. Adds 6 free vision models.
                    </p>
                </div>

                <!-- Google Gemini API Key -->
                <div class="space-y-2">
                    <label for="google-gemini-key" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                        Google Gemini API Key (Optional)
                        <span class="text-xs text-gray-500 dark:text-gray-400 ml-2">AIzaSy...</span>
                    </label>
                    <input type="password" id="google-gemini-key"
                        class="w-full p-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all"
                        placeholder="AIzaSy...">
                    <p class="text-xs text-gray-500 dark:text-gray-400">
                        Get yours at <a href="https://makersuite.google.com/app/apikey" target="_blank"
                            class="text-purple-600 dark:text-purple-400 hover:underline">Google AI Studio</a>.
                        Free tier available. Adds 4 fast Gemini models (1.6s - 4.8s).
                    </p>
                </div>

                <!-- Active Providers List -->
                <div class="mt-6 p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg">
                    <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Active Providers:</h3>
                    <div id="active-providers-list" class="text-sm text-gray-600 dark:text-gray-400">
                        Loading...
                    </div>
                </div>

                <!-- Security Note -->
                <div
                    class="mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                    <div class="flex items-start gap-2">
                        <i class="fas fa-shield-alt text-blue-600 dark:text-blue-400 mt-0.5"></i>
                        <div class="text-xs text-blue-800 dark:text-blue-300">
                            <strong>Security:</strong> Keys are stored locally in your browser and never sent to our
                            servers.
                            They're only used to authenticate with the respective AI providers.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div
                class="sticky bottom-0 bg-white/95 dark:bg-gray-900/95 border-t border-gray-200 dark:border-gray-700 p-6 rounded-b-2xl flex gap-3">
                <button id="save-api-keys"
                    class="flex-1 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl">
                    üíæ Save Keys
                </button>
                <button id="clear-api-keys"
                    class="bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200">
                    üóëÔ∏è Clear All
                </button>
            </div>
        </div>
    </div>

</body>

</html>